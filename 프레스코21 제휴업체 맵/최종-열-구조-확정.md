# ✅ 최종 열 구조 확정!

## 📊 확정된 구글 시트 열 구조

```
A: 타임스탬프 (자동)
B: 업체명 (폼 1번)
C: 카테고리 (폼 2번)
D: 대표자성함 (폼 3번)
E: 사업자등록번호 (폼 4번)
F: 도로명 주소 (폼 5번)
G: 상세 주소 (폼 6번)
H: 대표 전화번호 (폼 7번)
I: 담당자 이메일 (폼 8번)
J: 운영 시간 (폼 9번)
K: 홈페이지/SNS 링크 (폼 10번)
L: 업체 한 줄 소개 (폼 11번)
M: 업체 대표 이미지 (폼 12번)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
N: 관리자메모 (관리자 수동 입력)
O: 협회 (폼 13번) ⚠️ N열을 자동으로 건너뜀
P: 심사상태 (관리자 수동 입력 - '승인' 시 자동화)
Q: 위도 (자동 생성)
R: 경도 (자동 생성)
```

---

## 🎯 왜 이렇게 됐나?

### 문제 상황
- 구글 폼 질문: **총 13개**
- 예상: B~N열에 질문 1~13번이 들어가야 함
- 현실: B~M열(질문 1~12번), **N열 건너뜀**, O열(질문 13번)

### 원인 (추정)
- 구글 폼/시트의 알 수 없는 동작
- N열이 이미 특별한 용도로 예약되어 있거나
- 폼-시트 연동 시 N열을 자동으로 건너뜀

### 해결책
- **현실을 받아들이고** 코드를 맞춤
- N열을 관리자메모로 활용 (어차피 비어있으니)
- O열 = 협회 (폼이 자동으로 입력)

---

## 📝 구글 시트 헤더 설정

### 1행에 이렇게 입력:

| A | B | C | ... | M | N | O | P | Q | R |
|---|---|---|-----|---|---|---|---|---|---|
| 타임스탬프 | 업체명 | 카테고리 | ... | 업체 대표 이미지 | 관리자메모 | 협회 | 심사상태 | 위도 | 경도 |

---

## 🔧 Apps Script 코드 수정 완료

### onEdit 함수
```javascript
// P열(16번째 열) 감시
if (col !== 16) return;

// P열에 '승인' 입력 시
var statusCell = sheet.getRange(row, 16); // P열
if (statusValue === '승인') {
  // Q, R열에 좌표 입력
  var latCell = sheet.getRange(row, 17); // Q열
  var lngCell = sheet.getRange(row, 18); // R열
}
```

### doGet 함수
```javascript
var status = String(row[15] || '').trim();  // P열 (인덱스 15)
var lat = parseFloat(row[16]) || 0;         // Q열 (인덱스 16)
var lng = parseFloat(row[17]) || 0;         // R열 (인덱스 17)

var partner = {
  // ...
  association: String(row[14] || '').trim(), // O열 (인덱스 14)
  lat: lat,                                  // Q열
  lng: lng                                   // R열
};
```

---

## ✅ 적용 체크리스트

### 1단계: 구글 시트 헤더 설정
- [ ] N열 헤더: "관리자메모"
- [ ] O열 헤더: "협회"
- [ ] P열 헤더: "심사상태"
- [ ] Q열 헤더: "위도"
- [ ] R열 헤더: "경도"

### 2단계: Apps Script 업데이트
- [x] 코드 수정 완료
- [ ] Google Apps Script 에디터 열기
- [ ] 기존 코드 전체 삭제
- [ ] 새 코드 붙여넣기 (Google-Apps-Script-제휴업체-자동화.js)
- [ ] 저장 (Cmd/Ctrl + S)
- [ ] 배포 → 배포 관리 → ✏️ 수정 → 새 버전 → 배포

### 3단계: 테스트
- [ ] 구글 폼 테스트 응답 제출
- [ ] O열에 협회 데이터 확인
- [ ] N열에 수동으로 메모 입력 (선택)
- [ ] P열에 '승인' 입력
- [ ] Q, R열에 자동으로 좌표 생성 확인

### 4단계: Apps Script 함수 테스트
- [ ] testDoGet 함수 실행
- [ ] 로그에서 "성공: true" 확인
- [ ] association 필드에 O열 데이터 포함 확인

---

## 🎮 사용 방법

### 신청자 → 폼 작성
```
1~12번 질문: B~M열에 자동 저장
13번 질문(협회): O열에 자동 저장 (N열 건너뜀)
```

### 관리자 → 검토 및 승인
```
1. N열: 관리자메모 입력 (선택)
   예: "서울 지역 우선 검토 필요"

2. P열: 심사상태 입력
   - "대기중" / "검토중" / "승인" / "거부"
   
3. P열에 "승인" 입력 시:
   → 자동으로 Q, R열에 좌표 생성
```

### 시스템 → 자동화
```
P열 = "승인" 감지
→ F열(도로명 주소) 읽기
→ Google Maps Geocoding
→ Q열(위도), R열(경도) 자동 입력
```

---

## 📊 데이터 흐름 예시

### 입력 (구글 폼)
```
질문 1: 도담공방 → B열
질문 2: 도자기 → C열
...
질문 12: https://drive.google.com/... → M열
질문 13: 한국공예협회 → O열 (N열 자동 건너뜀)
```

### 관리 (관리자)
```
N열: "우수 업체" (메모)
P열: "승인" (입력)
```

### 출력 (자동 생성)
```
Q열: 37.5665354 (위도)
R열: 127.1222909 (경도)
```

### JSON API
```json
{
  "name": "도담공방",
  "category": "도자기",
  "association": "한국공예협회",
  "lat": 37.5665354,
  "lng": 127.1222909
}
```

---

## 🎯 중요 포인트

### ✅ DO
- N열은 관리자메모로 자유롭게 사용
- O열은 구글 폼이 자동으로 채움 (수정 X)
- P열에 '승인' 입력해야 지도에 표시
- Q, R열은 절대 수동 입력 금지 (자동 생성)

### ❌ DON'T
- N열을 삭제하거나 이름 변경 금지
- O열 데이터 수동 수정 금지 (폼 응답 깨짐)
- P열을 다른 곳으로 이동 금지 (자동화 깨짐)
- Q, R열에 수동으로 좌표 입력 금지

---

## 🐛 문제 해결

### Q: P열에 '승인' 입력했는데 좌표가 안 생겨요
```
1. Apps Script 재배포 확인
2. F열(도로명 주소)에 값이 있는지 확인
3. testGeocodeRow 함수 실행 (수동 테스트)
4. 실행 로그 확인 (Cmd/Ctrl + Enter)
```

### Q: 구글 폼 응답이 여전히 O열에 안 가요
```
1. 폼 질문이 정확히 13개인지 확인
2. 폼-시트 연결 해제 후 재연결
3. 테스트 응답 제출 후 확인
```

### Q: JSON에 협회가 안 나와요
```
1. O열에 협회 데이터가 있는지 확인
2. testDoGet 함수 실행
3. 로그에서 association: "..." 확인
4. Apps Script 재배포 확인
```

---

## 📁 관련 파일

- **Google-Apps-Script-제휴업체-자동화.js** ✅ 최종 수정 완료
- **최종-열-구조-확정.md** ✅ 이 파일

---

**업데이트 날짜:** 2025-01-05  
**최종 버전:** 3.0 (N열 관리자메모, O열 협회, P열 심사상태)  
**상태:** 확정 및 적용 대기 중

