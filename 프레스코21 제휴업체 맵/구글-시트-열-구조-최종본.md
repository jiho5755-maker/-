# ✅ 구글 시트 열 구조 재구성 완료!

## 🎯 변경 사항 요약

### 이전 구조 (문제 발생)
```
N열: 심사상태 (관리자)
O열: 위도 (자동)
P열: 경도 (자동)
Q열: 협회 (폼 응답) ← 여기로 가야 하는데...
```
→ 폼 응답이 N열로 가버려서 충돌!

### 새로운 구조 (해결)
```
N열: 협회 (폼 응답 13번)
O열: 관리자메모 (관리자)
P열: 심사상태 (관리자)
Q열: 위도 (자동)
R열: 경도 (자동)
```
→ 폼 응답과 관리자 항목 분리!

---

## 📋 전체 열 구조

| 열 | 항목 | 입력 방식 | 용도 |
|----|------|-----------|------|
| A | 타임스탬프 | 자동 | 신청 일시 |
| B | 업체명 | 폼 | 제휴업체 이름 |
| C | 카테고리 | 폼 | 공예 종류 (다중 가능) |
| D | 대표자성함 | 폼 | JSON 제외 |
| E | 사업자번호 | 폼 | JSON 제외 |
| F | 도로명 주소 | 폼 | Geocoding 대상 |
| G | 상세 주소 | 폼 | 건물/층수 |
| H | 전화번호 | 폼 | 연락처 |
| I | 이메일 | 폼 | JSON 제외 |
| J | 운영시간 | 폼 | 영업시간 |
| K | 링크 | 폼 | SNS/홈페이지 (다중 가능) |
| L | 소개 | 폼 | 한 줄 소개 |
| M | 이미지 | 폼 | Google Drive 링크 |
| **N** | **협회** | **폼** | **구글 폼 13번 질문** |
| **O** | **관리자메모** | **관리자** | **내부 메모** |
| **P** | **심사상태** | **관리자** | **'승인' 입력 시 자동화** |
| **Q** | **위도** | **자동** | **Geocoding 결과** |
| **R** | **경도** | **자동** | **Geocoding 결과** |

---

## 🚀 적용 완료된 파일

### ✅ Google-Apps-Script-제휴업체-자동화.js
- onEdit: P열 감시, Q/R열에 좌표 입력
- doGet: N열 협회 읽기, P열 심사상태 확인
- testGeocodeRow: P열 확인, Q/R열 입력

**상태:** 코드 수정 완료 ✅  
**다음 단계:** Apps Script 에디터에 복사 → 재배포

---

## 📝 해야 할 일 (순서대로)

### 1️⃣ 구글 시트 헤더 정리 (1분)
```
O열: 관리자메모
P열: 심사상태
Q열: 위도
R열: 경도
```

### 2️⃣ Apps Script 업데이트 (3분)
```
1. 확장 프로그램 → Apps Script
2. 기존 코드 전체 삭제
3. Google-Apps-Script-제휴업체-자동화.js 복사 붙여넣기
4. 저장
5. 배포 → 배포 관리 → 수정 → 새 버전 → 배포
```

자세한 가이드: `Apps-Script-업데이트-가이드.md`

### 3️⃣ 구글 폼에 협회 항목 추가 (2분)
```
1. 구글 폼 편집 모드
2. 마지막 질문(업체 대표 이미지) 다음에 추가
3. 질문 유형: 체크박스
4. 옵션: 한국공예협회, 서울공방협회, ... 기타
5. "기타" 옵션에서 "기타 답변 추가" 체크
```

### 4️⃣ 테스트 (2분)
```
1. 구글 폼 테스트 응답 제출
2. N열에 협회 데이터 확인
3. P열에 '승인' 입력
4. Q, R열에 자동으로 좌표 생성 확인
5. Apps Script testDoGet 함수 실행
6. 로그에서 association 필드 확인
```

---

## 🎨 구글 폼 "협회" 질문 설정

```
📋 질문:
소속 협회를 선택해주세요

☑️ 유형:
체크박스

✅ 옵션:
□ 한국공예협회
□ 한국공예·디자인문화진흥원
□ 서울공방협회
□ 경기공방협회
□ 부산공예협회
□ 기타 (텍스트 입력 활성화)

💡 설명:
해당하는 협회를 모두 선택해주세요.
목록에 없는 협회는 "기타"를 선택 후 입력해주세요.

❓ 필수:
선택 (OFF)
```

**"기타" 옵션 설정 중요!**
- "기타" 우측 ⋮ 메뉴 클릭
- "기타 답변 추가" 체크 ✅

---

## 🔧 작동 방식

### 1️⃣ 신청자가 폼 작성
```
체크박스: ☑️ 한국공예협회, ☑️ 기타: 전국도자기협회
```

### 2️⃣ 구글 시트 저장
```
N열: 한국공예협회, 기타: 전국도자기협회
```

### 3️⃣ 관리자 승인
```
P열에 '승인' 입력
```

### 4️⃣ 자동 Geocoding
```
F열 주소 → Q열(위도), R열(경도) 자동 입력
```

### 5️⃣ 지도 표시
```
- P열이 '승인'
- Q, R열에 좌표 존재
→ 지도에 마커 표시

협회 정보:
- N열의 "기타:" 항목은 필터에서 제외
- 승인된 협회만 필터 버튼 생성
```

---

## 📊 예시 데이터

### 구글 시트 예시 (2행)

| A | B | C | ... | N | O | P | Q | R |
|---|---|---|-----|---|---|---|---|---|
| 2025-01-05 | 도담공방 | 도자기 | ... | 한국공예협회, 기타: 전국도자기협회 | 검토 필요 | 승인 | 37.5665 | 126.9780 |

### JSON 출력 예시

```json
{
  "name": "도담공방",
  "category": "도자기",
  "association": "한국공예협회, 기타: 전국도자기협회",
  "lat": 37.5665,
  "lng": 126.9780
}
```

### 지도 필터 버튼

```
[전체] [한국공예협회] [서울공방협회] ...
```
→ "전국도자기협회"는 표시 안됨 (기타:로 시작)

---

## 🎯 장점

### ✅ 데이터 정합성
- 폼 응답이 자연스럽게 A~N열로 정렬
- 관리자 항목이 O~R열로 분리
- 충돌 없음

### ✅ 확장성
- 새 협회 발견 가능
- 미승인 협회는 데이터베이스에만 저장
- 관리자가 검토 후 승인

### ✅ 관리 편의
- 관리자메모 별도 관리 (O열)
- 심사상태로 자동화 트리거 (P열)
- 위도/경도 자동 생성 (Q, R열)

---

## 📁 관련 파일

1. **Google-Apps-Script-제휴업체-자동화.js** ✅ 수정 완료
2. **Apps-Script-업데이트-가이드.md** ✅ 신규 생성
3. **구글-시트-열-구조-최종본.md** ✅ 신규 생성 (이 파일)

---

## 💡 다음 단계

1. Apps Script 업데이트 (3분)
2. 구글 폼에 협회 질문 추가 (2분)
3. 테스트 (2분)
4. 전체 시스템 확인 (3분)

**예상 소요 시간:** 10분  
**난이도:** ⭐⭐☆☆☆

---

**업데이트 날짜:** 2025-01-05  
**담당자:** AI Assistant  
**버전:** 2.0 (N열 협회, P열 심사상태)

