# 제휴업체 지도 연동 - 배포 및 테스트 가이드

## 🔧 단계별 설정 방법

### 1단계: Google Apps Script 배포 (필수!)

`doGet` 함수를 웹 앱으로 배포해야 HTML에서 API를 호출할 수 있습니다.

#### 배포 방법:

1. **Google Apps Script 편집기에서:**
   - 상단 메뉴에서 **"배포"** 클릭
   - **"새 배포"** 선택
   
2. **배포 설정:**
   - ⚙️ **설정 아이콘** 클릭 (오른쪽)
   - **유형:** "웹 앱" 선택
   - **설명:** "제휴업체 API v1" (원하는 설명 입력)
   - **실행 사용자:** "나"
   - **액세스 권한:** "모든 사용자" ⚠️ **중요!**
   - **"배포"** 버튼 클릭

3. **웹 앱 URL 복사:**
   - 배포 완료 후 나오는 **"웹 앱 URL"** 복사
   - 예: `https://script.google.com/macros/s/AKfycbw.../exec`

4. **HTML 파일에 URL 입력:**
   - `제휴업체-지도-통합본.html` 파일 열기
   - 354번째 줄 근처의 `GOOGLE_SHEET_API_URL` 변수에 복사한 URL 붙여넣기

---

### 2단계: 시트 이름 확인

`doGet` 함수가 올바른 시트를 읽는지 확인하세요.

- 현재 코드: `ss.getActiveSheet()` - 현재 활성 시트 사용
- 데이터가 있는 시트가 열려있어야 합니다.

**만약 특정 시트 이름을 지정하고 싶다면:**
- `doGet` 함수 128번째 줄을 다음과 같이 수정:
  ```javascript
  var sheet = ss.getSheetByName('제휴업체'); // 시트 이름 변경
  ```

---

### 3단계: 테스트 순서

#### ✅ Apps Script에서 테스트 (배포 전)

1. **testDoGet 함수 실행:**
   - 함수 드롭다운에서 `testDoGet` 선택
   - 실행 버튼 클릭
   - 실행 로그 확인:
     - "성공: true" 확인
     - "제휴업체 수: X" 확인
     - 데이터가 정상적으로 나오는지 확인

2. **testGeocodeRow 함수 실행:**
   - 특정 행(예: 2행)의 주소가 좌표로 변환되는지 테스트
   - 실행 후 O, P열에 위도/경도가 입력되었는지 확인

#### ✅ 웹 배포 후 테스트

1. **브라우저 개발자 도구 열기:**
   - HTML 파일을 브라우저에서 열기
   - **F12 키** 또는 **우클릭 > 검사**
   - **Console 탭** 열기

2. **에러 확인:**
   - 빨간색 에러 메시지 확인
   - 에러 내용 확인

3. **Network 탭 확인:**
   - Network 탭 열기
   - 페이지 새로고침
   - API URL로 시작하는 요청 찾기
   - 상태 코드 확인 (200 = 성공, 401/403 = 권한 오류)

---

### 4단계: 문제 해결

#### 문제 1: "데이터를 불러올 수 없습니다" 에러

**가능한 원인:**
- ✅ 웹 앱 배포가 안 되어 있음
- ✅ 액세스 권한이 "모든 사용자"로 설정되지 않음
- ✅ URL이 잘못 입력됨

**해결 방법:**
1. 배포가 완료되었는지 확인
2. 배포 설정에서 "액세스 권한"을 "모든 사용자"로 변경
3. 새 배포를 생성하거나 기존 배포를 업데이트
4. HTML 파일의 URL이 최신 배포 URL인지 확인

#### 문제 2: "표시할 업체가 없습니다"

**가능한 원인:**
- ✅ N열(심사상태)이 "승인"인 행이 없음
- ✅ O, P열(위도/경도)이 비어있음

**해결 방법:**
1. 스프레드시트에서 N열에 "승인" 입력
2. `testGeocodeRow` 함수로 좌표 자동 입력
3. 또는 수동으로 O, P열에 위도/경도 입력

#### 문제 3: CORS 오류 (브라우저 콘솔에 표시)

**가능한 원인:**
- ✅ 액세스 권한 설정 문제

**해결 방법:**
- 배포 설정에서 "액세스 권한: 모든 사용자" 확인

---

### 5단계: 최종 확인 체크리스트

- [ ] Google Apps Script 코드 저장 완료
- [ ] `testDoGet` 함수 실행 후 데이터 정상 출력 확인
- [ ] 웹 앱 배포 완료 (액세스 권한: 모든 사용자)
- [ ] HTML 파일의 `GOOGLE_SHEET_API_URL`에 배포 URL 입력
- [ ] 스프레드시트에 "승인" 상태인 업체 데이터 존재
- [ ] O, P열에 위도/경도 값 존재
- [ ] 브라우저 콘솔에서 에러 없음
- [ ] 네이버 지도에 마커 표시됨

---

## 🚀 빠른 테스트 방법

### 방법 1: testDoGet 함수로 확인 (가장 빠름)

1. Apps Script 편집기에서 `testDoGet` 함수 실행
2. 실행 로그에서 JSON 데이터 확인
3. "partners" 배열에 데이터가 있는지 확인

### 방법 2: 브라우저에서 직접 API 호출

1. 배포 완료 후 웹 앱 URL을 브라우저 주소창에 입력
2. JSON 데이터가 보이면 성공!

예:
```
https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
```

---

## 📝 참고사항

- **배포 후 코드 수정 시:** 새 배포를 생성하거나 기존 배포를 "새 버전"으로 업데이트해야 합니다.
- **액세스 권한:** "모든 사용자"로 설정하지 않으면 외부에서 접근할 수 없습니다.
- **시트 구조:** A~P열 구조가 요구사항과 일치하는지 확인하세요.

---

## 🆘 도움이 필요하신가요?

문제가 계속되면 다음 정보를 확인해주세요:

1. 브라우저 콘솔(F12)의 에러 메시지
2. testDoGet 함수의 실행 로그
3. 스프레드시트의 데이터 구조 (스크린샷)

