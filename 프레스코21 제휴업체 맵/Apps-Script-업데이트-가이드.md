# 🔧 Apps Script 업데이트 가이드

## ✅ 수정 완료!

구글 시트 열 구조 변경에 맞춰 Apps Script를 업데이트했습니다.

---

## 📊 최종 열 구조

```
A: 타임스탬프 (자동)
B: 업체명 (폼)
C: 카테고리 (폼)
D: 대표자성함 (폼)
E: 사업자등록번호 (폼)
F: 도로명 주소 (폼) ← Geocoding 대상
G: 상세 주소 (폼)
H: 대표 전화번호 (폼)
I: 담당자 이메일 (폼)
J: 운영 시간 (폼)
K: 홈페이지/SNS 링크 (폼)
L: 업체 한 줄 소개 (폼)
M: 업체 대표 이미지 (폼)
N: 협회 (폼) ← 구글 폼 13번 질문
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
O: 관리자메모 (관리자 수동 입력)
P: 심사상태 (관리자 수동 입력) ← '승인' 입력 시 자동 Geocoding
Q: 위도 (자동 생성)
R: 경도 (자동 생성)
```

---

## 🚀 적용 방법

### 1단계: Google Apps Script 열기

1. 구글 시트 열기
   ```
   https://docs.google.com/spreadsheets/d/1YIEguQ2pe7awPVSc1wW9e_RPqbnuZcw--nbvEfE0USE/edit
   ```

2. 메뉴: **확장 프로그램** → **Apps Script**

### 2단계: 코드 전체 교체

1. 기존 코드 **전체 선택** (`Cmd/Ctrl + A`)
2. **삭제**
3. 새 파일 열기:
   ```
   Google-Apps-Script-제휴업체-자동화.js
   ```
4. 전체 복사 후 붙여넣기

### 3단계: 저장 및 재배포

1. **저장** (`Cmd/Ctrl + S`)
2. **배포** → **배포 관리**
3. 기존 배포 우측의 **✏️ (연필 아이콘)** 클릭
4. **버전**: "새 버전" 선택
5. **배포** 클릭

### 4단계: 테스트

#### 테스트 A: testDoGet 함수

```
1. 함수 드롭다운에서 "testDoGet" 선택
2. 실행 버튼 클릭
3. 실행 로그 확인 (Cmd/Ctrl + Enter)
4. "성공: true", "제휴업체 수: N" 확인
5. 협회 데이터가 포함되어 있는지 확인
```

#### 테스트 B: testGeocodeRow 함수

```
1. P열에 '승인' 입력 (아무 행)
2. Q, R열 비워두기
3. 함수 드롭다운에서 "testGeocodeRow" 선택
4. 필요시 코드 287줄의 rowNumber 수정
5. 실행 버튼 클릭
6. Q, R열에 좌표가 자동 입력되는지 확인
```

#### 테스트 C: onEdit 트리거

```
1. P열에 '승인' 입력 (새 행)
2. 자동으로 Q, R열에 좌표 입력되는지 확인
3. 1-2초 정도 대기
```

---

## 🎯 주요 변경 사항

### onEdit 함수
```
변경 전: N열(14) 감시 → O열(15), P열(16)에 좌표 입력
변경 후: P열(16) 감시 → Q열(17), R열(18)에 좌표 입력
```

### doGet 함수
```
변경 전:
- status: row[13] (N열)
- lat: row[14] (O열)
- lng: row[15] (P열)
- association: row[16] (Q열)

변경 후:
- status: row[15] (P열)
- lat: row[16] (Q열)
- lng: row[17] (R열)
- association: row[13] (N열)
```

---

## ✅ 체크리스트

### Apps Script
- [ ] 코드 전체 교체
- [ ] 저장 완료
- [ ] 재배포 완료 (새 버전)
- [ ] testDoGet 실행 성공
- [ ] testGeocodeRow 실행 성공
- [ ] onEdit 트리거 정상 작동

### 구글 시트
- [ ] O열 헤더: "관리자메모"
- [ ] P열 헤더: "심사상태"
- [ ] Q열 헤더: "위도"
- [ ] R열 헤더: "경도"
- [ ] P열에 '승인' 입력 시 Q, R열 자동 생성 확인

### 구글 폼
- [ ] 협회 질문 추가 (13번 질문)
- [ ] 체크박스 방식 설정
- [ ] "기타" 옵션 + 텍스트 입력 활성화
- [ ] 테스트 응답 제출
- [ ] N열에 협회 데이터 입력 확인

---

## 🐛 문제 해결

### P열에 '승인' 입력해도 좌표가 안 생성돼요
```
1. Apps Script 재배포 확인
2. 시트를 새로고침
3. F열(도로명 주소)에 값이 있는지 확인
4. testGeocodeRow 함수로 수동 테스트
```

### JSON에 협회가 안 나와요
```
1. N열에 협회 데이터가 있는지 확인
2. testDoGet 함수 실행
3. 로그에서 association 필드 확인
4. 재배포 확인
```

### 구글 폼 응답이 N열로 안 가요
```
1. 구글 폼 질문 순서 확인 (협회가 13번째인지)
2. 폼-시트 연결 해제 후 재연결
3. 테스트 응답 제출 후 확인
```

---

## 📞 추가 도움

문제가 계속되면:
1. Apps Script 실행 로그 확인 (`Cmd/Ctrl + Enter`)
2. 오류 메시지 스크린샷
3. 구글 시트 1-2행 스크린샷

---

**업데이트 날짜:** 2025-01-05
**버전:** 2.0 (N열 협회, P열 심사상태)

